# 6장 Grafana를 활용한 Dashboard

Grafana는 Prometheus를 꾸준히 지원

## 설치

공식 홈페이지에서 다운로드. docker로 실행시킬 수 있음

## 데이터 소스

* 그래프를 그릴 때 필요한 정보를 추출하기 위해 data source를 사용함.
* 일반적으로 실행 중인 프로메테우스마다 1개의 데이터 소스를 사용함.
* access 항목을 proxy로 설정할 경우 Grafana가 Prometheus로 데이터 소스를 요청함.
  * direct로 설정 시 웹 브라우저에서 직접 요청함.

## 대쉬 보드와 패널

* Panels는 그래프나 테이블, 또는 시각화된 다른 정보를 포함하는 사각의 공간.

### 그래프 장벽 회피하기

* 여러 팀이 모두 함께 쓰는 대시보드나 다양한 목적을 단번에 해결하는 대시보드를 만드려고 해서는 안되며, 각 팀과 목적에 맞는 대시보드를 개별적으로 제공해야 한다.
* 행과 패널의 수를 더 줄여서 표시해야 함.
  * 전반적인 개요는 한 화면에서 적절하게 표시되어야 하며, 멀리서 봐도 쉽게 이해가 가능해야함.
  * 대기 (oncall) 상태에서 사용되는 대시보드는 한두 행 정도를 더 넣어도 무방
  * 전문가가 심층적인 성능 튜닝용으로 사용하는 대시보드는 여러 개의 화면을 띄워 동작할 수도 있음.
  * 대시보드에 표시되는 그래프와 라인, 숫자들이 모두 대시보드를 어렵게 만들기 때문.
* 그래프가 많은 것은 우수한 모니터링이 아님.
* 더 빠르게 사고에 대응해 해결하고 더 뛰어난 공학적 결정을 내리기 위한 것.

## 그래프 패널

* Metrics 탭에서 쿼리 표현식을 입력함.
* 일반 수식 브라우저보다 더 많은 기능 제공

### 시간 제어

시간제어는 전체 대시보드에 한꺼번에 적용됨.

## 단일 상태 패널

* singlestat panel은 하나의 time series 값만 표시함.
* 기본적으로 단일 상태 패널은 대시보드의 시간 범위 동안의 시계열 평균값을 계산함.
* time series 값에 따라 색상을 다르게 하거나 sparkline을 표시하는 기능도 있다.

## 테이블 패널

* 여러개의 time series를 표시할 수 있음.

## 템플릿 변수

* 노드가 많은 경우 모든 머신에 대해서 대시보드를 만들 필요는 없다.
* 이런 경우에는 템플릿을 이용하면 된다.
* dropdown 메뉴가 추가됨.
* 여기서 `$Device` 와 같은 형식으로 사용.??