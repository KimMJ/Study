# 어노테이션 기반 AOP

## 어노테이션 기반 AOP 설정

### 어노테이션 사용을 위한 스프링 설정

* AOP를 어노테이션으로 설정하려면 먼저 스프링 설정파일에 `<aop:aspectj-autoproxy>`를 선언해야 한다.
* AOP 관련 어노테이션들은 어드바이스 클래스에 설정한다.
* 어드바이스 클래스에 선언된 어노테이션들을 스프링 컨테이너가 처리하게 하려면, 반드시 어노테이션 객체가 생성되어 있어야 한다.
* 따라서 어드바이스 클래스는 반드시 스프링 설정파일에 `<bean>`으로 등록하거나 `@Service` 어노테이션을 사용하여 컴포넌트가 검색될 수 있도록 해야한다.

### 포인트컷 설정

* XML 설정에서 포인트컷을 선언할 때는 `<aop:pointcut>` 엘리먼트를 사용했었다.
* 그리고 여러 포인트컷을 식별하기 위해 유일한 아이디를 지정했고, 이후에 에스펙트 설정에서 특정 포인트컷을 참조할 수 있었다.
* 어노테이션 설정으로 포인트컷을 선언할 때는 `@Pointcut`을 사용하며, 하나의 어드바이스 클래스 안에 여러 개의 포인트컷을 선언할 수 있다.
* 여러 포인트컷을 식별하기 위한 식별자가 필요하고 이때 참조 메소드를 이용한다.
* 참조 메소드는 구현 로직이 없는 메소드.
* 어떤 기능을 처리를 목적으로 하는 것이 아니라 단순히 포인트컷을 식별하는 이름으로만 사용.

### 어드바이스 설정

* 어드바이스 클래스에는 횡단 관심에 해당하는 어드바이스 메소드가 구현되어 있다.
* 어드바이스 메소드가 언제 동작할지 결정하여 관련된 어노테이션을 메소드 위에 설정하면 됨.
* 이때 반드시 어드바이스 메소드가 결합될 포인트컷을 참조해야함.
* 포인트컷 참조 방법은 어드바이스 어노테이션 뒤에 괄호를 추가하고 포인트컷 참조 메소드를 지정하면 됨.

### 애스팩트 설정

* AOP 설정에서 가장 중요한 애스팩트는 `@Aspect`를 이용하여 설정.
* 애스팩트는 포인트컷과 어드바이스의 결합.
* `@Aspect`가 설정된 에스팩트 객체에는 반드시 포인트컷과 어드바이스를 결합하는 설정이 있어야 함.

## 어드바이스 동작 시점

### Before

* 지정된 메소드를 실행하기 전
* `@Before("POINTCUT()")`

### After Returning

* 지정된 메소드가 실행되고 정상 리턴된 후
* `@AfterReturning(pointcut="POINTCUT()", returning="RETURNING_OBJ")`
* returning 속성은 비즈니스 메소드 수행 결과를 받아내기 위한 바인드 변수를 지정해야 하기 때문.

### After Throwing

* 지정된 메소드가 오류로 종료되고 난 후
* `@AfterThrowing(pointcut="POINTCUT()", throwing="EXCEPTION_OBJ")`
* throwing 속성은 바인드 변수


### After

* 지정된 메소드가 종료되고 난 후
* `@After("POINTCUT()")`
* 바인드 변수는 없음

### Around

* 지정된 메소드의 실행 전, 종료 후
* `Around("POINTCUT()")`
* 바인드 변수는 없음
* 그러나 ProceedingJoinPoint 객체를 매개변수로 받아야 하는것은 중요. (`proceed()` 메소드 때문)

### 외부 Pointcut 참조

* 어노테이션으로 하다보면 어드바이스 클래스마다 포인트컷 설정이 포함되면서, 비슷하거나 같은 포인트컷이 반복 선언되는 문제 발생.
* 이를 해결하기 위해 포인트컷을 외부에 독립된 클래스에 따로 설정.
