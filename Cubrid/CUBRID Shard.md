# CUBRID Shard

* 지속적으로 데이터가 증가하는 서비스에서 DB노드를 증설할 때 좀 더 편리하게 하기 위해
* 개발자가 지정한 룰에 의해 데이터를 원하는 DB에 분산 저장하여 쓰기부하 분산.
* 대용량 서비스에 적용할 수 있는 기능.

## 특징

* 각각의 shard DB의 스키마는 동일
* 브로커 : 샤딩 룰을 파일로 관리 (shard_key.txt)
* 샤딩 정책 : Modulo / User-defined Hash Function
* SQL 힌트를 명시적으로 사용하여 질의 분산 처리 (SQL 수정 필요)
* 샤드 DB 추가 시에는 응용 코드의 수정 없이, 샤딩 / 커넥션 룰만 수정하면 됨.
* N개의 shard DB로부터 집계 연산 / 조인 연산 불가
* 자동 데이터 리밸런싱 미지원

## SQL 힌트

1. `/*+shard_key*/` : 질의 내 shard key 칼럼이 존재하면, 바인딩할 키 값의 앞에 명시하는 힌트
2. `/*+shard_val*/` : 질의 내 shard key 칼럼이 없으면, 키 값을 명시하기 위해 사용하는 힌트
3. `/*+shard_id*/` : 질의를 특정 shard DB에서 실행하고자 할 떄 사용하는 힌트

## 구조

* DB는 shard를 여러대 구성하고 shard 설정.
* 브로커는 연결 분석, 관리. shard 힌트를 분석하여 적절한 연산 shard DB로 질의 실행 계획.
* 이를 Shard Proxy라고 함. (9.2.0부터 통합.)

### nDrive

* shard를 적용.
* 대량의 연결 관리
* 간편한 DB 추가
* 쓰기 부하 분산
* 고가용성 확보
